<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermarket Scanner App</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        header h1 {
            color: #27ae60;
        }
        .scanner-container, .cart-container, .payment-container {
            margin-bottom: 20px;
        }
        h2 {
            color: #27ae60;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 10px;
        }
        #video {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: block;
            border: 2px solid #27ae60;
            border-radius: 8px;
        }
        .cart {
            margin-top: 20px;
        }
        .cart ul {
            list-style-type: none;
            padding: 0;
        }
        .cart ul li {
            background-color: #f4f4f4;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .total {
            text-align: right;
            margin-top: 20px;
            font-size: 1.2em;
        }
        .pay-button, .scan-button, .upload-button, .add-more-button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            text-align: center;
            margin-top: 10px;
        }
        .pay-button:hover, .scan-button:hover, .upload-button:hover, .add-more-button:hover {
            background-color: #219150;
        }
        .file-input-container {
            text-align: center;
            margin-top: 10px;
        }
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Supermarket Scanner App</h1>
            <p>Scan products, add to cart, and checkout easily</p>
        </header>
        
        <section class="scanner-container">
            <h2>Scan Products</h2>
            <video id="video" autoplay></video>
            <button class="scan-button" onclick="startScan()">Scan</button>
            <div class="file-input-container">
                <label for="file-input" class="upload-button">Upload Image</label>
                <input type="file" id="file-input" class="file-input" accept="image/*" onchange="handleFile(event)">
            </div>
            <p id="scan-result"></p>
        </section>

        <section class="cart-container">
            <h2>Shopping Cart</h2>
            <div class="cart">
                <ul id="cart-items"></ul>
                <p class="total">Total: ₹<span id="total-value">0.00</span></p>
            </div>
        </section>

        <section class="payment-container">
            <h2>Payment</h2>
            <button class="pay-button" onclick="openPaymentOptions()">Pay Now</button>
            <button class="add-more-button" onclick="addMoreItems()">Add More Items</button>
        </section>
    </div>

    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script>
        const cart = [];
        let total = 0;

        function addToCart(product) {
            cart.push(product);
            total += product.price;
            updateCart();
        }

        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            cart.forEach(product => {
                const li = document.createElement('li');
                li.textContent = `${product.name} - ₹${product.price.toFixed(2)}`;
                cartItems.appendChild(li);
            });
            document.getElementById('total-value').textContent = total.toFixed(2);
        }

        function openPaymentOptions() {
            const paymentOptionsHTML = `
                <h1>Select Payment Method</h1>
                <button onclick="payOnline()">Pay Online</button>
                <button onclick="payWithCash()">Pay with Cash</button>
            `;
            const paymentWindow = window.open("", "_blank");
            paymentWindow.document.write(paymentOptionsHTML);
            paymentWindow.document.close();
        }

        function payOnline() {
            window.open("https://payments.google.com/gp/w/u/0/home/signup", "_blank");
        }

        function payWith(paymentMethod) {
            alert(`Redirecting to ${paymentMethod}...`);
            generateReceipt(paymentMethod);
        }

        function payWithCash() {
            alert('Please proceed with cash payment.');
            generateReceipt('Cash');
        }

        function generateReceipt(paymentMethod) {
            const receiptWindow = window.open("", "_blank");
            let receiptHTML = `<h1>Scan Mart</h1><p>Thank you for your purchase!</p><h2>Receipt</h2><ul>`;
            cart.forEach(product => {
                receiptHTML += `<li>${product.name} - ₹${product.price.toFixed(2)}</li>`;
            });
            receiptHTML += `</ul><p>Total: ₹${total.toFixed(2)}</p>`;
            receiptHTML += `<p>Payment Method: ${paymentMethod}</p>`;
            receiptHTML += `<p>Thank you!</p>`;
            receiptWindow.document.write(receiptHTML);
            receiptWindow.document.close();
        }

        function addMoreItems() {
            alert('You can add more items now!');
        }

        let videoStream;

        async function startScan() {
            const video = document.getElementById('video');
            const codeReader = new ZXing.BrowserMultiFormatReader();

            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = videoStream;
                video.play();

                codeReader.decodeFromVideoElement(video, (result, err) => {
                    if (result) {
                        alert('Product found but barcode scanning from video is not implemented yet');
                    }
                });
            } catch (error) {
                console.error('Error accessing camera:', error);
            }
        }

       function handleFile(event) {
    const file = event.target.files[0];
    if (file) {
        let product = null;
        if (file.name === "barcode.jpg") {
            product = { name: "Chocolate", price: 100.00 };
        } else if (file.name === "barcode2.png") {
            product = { name: "Sunflower-oil", price: 150.00 };
        } else if (file.name === "barcode3.jpg") {
            product = { name: "Shampoo", price: 50.00 };
        } else if (file.name === "barcode4.jpg") {
            product = { name: "Taj Mahal Tea Powder", price: 125.00 };
        }

        if (product) {
            addToCart(product);
        } else {
            const reader = new FileReader();
            reader.onload = async (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = async () => {
                    const codeReader = new ZXing.BrowserBarcodeReader();
                    try {
                        const result = await codeReader.decodeFromImageElement(img);
                        alert('Product found but barcode scanning from image is not implemented yet');
                    } catch (err) {
                        alert('Barcode not found or could not be read');
                        console.error(err);
                    }
                };
            };
            reader.readAsDataURL(file);
        }
    }
}

// Cleanup video stream on page unload
window.addEventListener('beforeunload', () => {
    if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
    }
});
</script>
</body>
</html>

